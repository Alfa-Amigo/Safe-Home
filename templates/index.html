<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeHome - Protecci√≥n Inteligente para tu Hogar</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/8.0.0/swiper-bundle.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>

:root {
    --primary: #1E88E5;
    --primary-dark: #1565C0;
    --primary-light: #64B5F6;
    --secondary: #0277BD;
    --accent: #00ACC1;
    --danger: #E53935;
    --warning: #FF8F00;
    --success: #00C853;
    --dark: #0D47A1;
    --light: #E3F2FD;
    --gray: #546E7A;
    
    --gradient-primary: linear-gradient(135deg, #1E88E5 0%, #0D47A1 100%);
    --gradient-secondary: linear-gradient(135deg, #0277BD 0%, #01579B 100%);
    --gradient-accent: linear-gradient(135deg, #00ACC1 0%, #00838F 100%);
    --gradient-header: linear-gradient(135deg, #1E88E5 0%, #1565C0 50%, #0D47A1 100%);
    --gradient-footer: linear-gradient(135deg, #0D47A1 0%, #1565C0 50%, #1E88E5 100%);
    --gradient-card: linear-gradient(135deg, rgba(30, 136, 229, 0.9) 0%, rgba(13, 71, 161, 0.8) 100%);
    
    --glass: rgba(255, 255, 255, 0.1);
    --glass-border: rgba(255, 255, 255, 0.2);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', sans-serif;
    line-height: 1.6;
    color: white;
    background: linear-gradient(135deg, #0D47A1 0%, #1E88E5 50%, #64B5F6 100%);
    min-height: 100vh;
    background-attachment: fixed;
}

.container {
    width: 90%;
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

.glass-header {
    background: var(--gradient-header);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: none;
    box-shadow: 0 8px 32px rgba(13, 71, 161, 0.3);
    border-radius: 0 0 30px 30px;
    padding: 25px 0;
    margin-bottom: 30px;
    position: relative;
    overflow: hidden;
}

.glass-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 100%;
    background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
    animation: shimmer 3s infinite;
}

@keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}


.glass-footer {
    background: var(--gradient-footer);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: none;
    box-shadow: 0 -8px 32px rgba(13, 71, 161, 0.3);
    border-radius: 30px 30px 0 0;
    margin-top: 50px;
    position: relative;
    overflow: hidden;
}

.glass-card {
    background: var(--gradient-card);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid var(--glass-border);
    box-shadow: 
        0 8px 32px 0 rgba(13, 71, 161, 0.3),
        inset 0 0 0 1px rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 30px;
    position: relative;
    overflow: hidden;
}

.glass-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
    pointer-events: none;
}


@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.floating-element {
    animation: float 3s ease-in-out infinite;
}


.header-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 20px;
    text-align: center;
}

.header-content h1 {
    font-size: 3rem;
    color: white;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 15px;
    font-weight: 700;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.header-content p {
    color: rgba(255, 255, 255, 0.9);
    font-size: 1.2rem;
    font-weight: 300;
}


.search-container {
    width: 100%;
    max-width: 600px;
    margin: 25px auto;
}

.search-box {
    display: flex;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    border-radius: 50px;
    padding: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
}

.search-box:focus-within {
    background: rgba(255, 255, 255, 0.25);
    box-shadow: 0 6px 25px rgba(0, 0, 0, 0.3);
    transform: translateY(-2px);
}

.search-box input {
    flex: 1;
    border: none;
    padding: 15px 25px;
    border-radius: 50px;
    outline: none;
    font-size: 1rem;
    background: transparent;
    color: white;
}

.search-box input::placeholder {
    color: rgba(255, 255, 255, 0.7);
}

.search-box button {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: none;
    background: var(--gradient-accent);
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-left: 5px;
    box-shadow: 0 4px 15px rgba(0, 172, 193, 0.4);
}

.search-box button:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(0, 172, 193, 0.6);
}

.risk-meter {
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(15px);
    border-radius: 20px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.15);
}

.risk-level {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
    font-size: 1.2rem;
}

.risk-level strong {
    color: var(--accent);
    font-weight: 600;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
}

.risk-visual {
    height: 15px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.risk-bar {
    height: 100%;
    width: 60%;
    background: var(--gradient-accent);
    border-radius: 10px;
    transition: width 0.5s ease;
    box-shadow: 0 2px 10px rgba(0, 172, 193, 0.5);
}


.slider-section {
    margin-bottom: 40px;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    flex-wrap: wrap;
}

.section-header h2 {
    font-size: 2.2rem;
    color: white;
    font-weight: 700;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.slider-nav {
    display: flex;
    gap: 12px;
}

.slider-nav button {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: var(--gradient-accent);
    border: none;
    color: white;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0, 172, 193, 0.4);
    transition: all 0.3s ease;
    font-size: 1.2rem;
}

.slider-nav button:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0, 172, 193, 0.6);
}

.recommendation-slider {
    width: 100%;
    height: 350px;
    border-radius: 25px;
    overflow: hidden;
}

.swiper-slide {
    background: var(--gradient-card);
    backdrop-filter: blur(15px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    display: flex;
    flex-direction: column;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.swiper-slide::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.05) 50%, transparent 70%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.swiper-slide:hover {
    transform: translateY(-8px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
}

.swiper-slide:hover::before {
    opacity: 1;
}

.slide-category {
    display: inline-block;
    padding: 8px 16px;
    background: var(--gradient-accent);
    color: white;
    border-radius: 25px;
    font-size: 0.9rem;
    margin-bottom: 20px;
    align-self: flex-start;
    font-weight: 600;
    box-shadow: 0 4px 15px rgba(0, 172, 193, 0.4);
}

.slide-title {
    font-size: 1.4rem;
    margin-bottom: 15px;
    color: white;
    font-weight: 600;
}

.slide-content {
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 25px;
    flex-grow: 1;
    line-height: 1.6;
    font-size: 1rem;
}

.slide-priority {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1rem;
    font-weight: 600;
}

.priority-high {
    color: #FF6B6B;
}

.priority-medium {
    color: #FFD93D;
}

.priority-low {
    color: #6BCF7F;
}


.map-section {
    margin-bottom: 40px;
}

.map-container {
    position: relative;
    height: 500px;
    border-radius: 25px;
    overflow: hidden;
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
    border: 2px solid rgba(255, 255, 255, 0.2);
}

#riskMap {
    height: 100%;
    width: 100%;
}

.map-overlay {
    position: absolute;
    top: 25px;
    right: 25px;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

#locateMe {
    background: var(--gradient-accent);
    border: none;
    padding: 15px 25px;
    border-radius: 30px;
    color: white;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0, 172, 193, 0.4);
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s ease;
    font-size: 1rem;
}

#locateMe:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0, 172, 193, 0.6);
}

.map-legend {
    display: flex;
    gap: 20px;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(15px);
    padding: 15px 25px;
    border-radius: 30px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.15);
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1rem;
    font-weight: 500;
    color: white;
}

.legend-item span {
    width: 18px;
    height: 18px;
    border-radius: 4px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.legend-high {
    background: #E53935;
}

.legend-medium {
    background: #FF8F00;
}

.legend-low {
    background: #00C853;
}


.upload-container {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.upload-area {
    width: 100%;
    max-width: 600px;
    padding: 60px;
    border: 3px dashed rgba(255, 255, 255, 0.4);
    border-radius: 25px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(15px);
    position: relative;
    overflow: hidden;
}

.upload-area::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.upload-area:hover {
    border-color: var(--accent);
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
}

.upload-area:hover::before {
    opacity: 1;
}

.upload-area i {
    font-size: 4rem;
    color: var(--accent);
    margin-bottom: 25px;
    text-shadow: 0 4px 15px rgba(0, 172, 193, 0.4);
}

.upload-area p {
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 30px;
    font-size: 1.2rem;
}

#fileInput {
    display: none;
}

.btn-primary {
    background: var(--gradient-accent);
    border: none;
    color: white;
    padding: 16px 40px;
    border-radius: 50px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 172, 193, 0.4);
    font-size: 1.1rem;
    position: relative;
    overflow: hidden;
}

.btn-primary::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
}

.btn-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0, 172, 193, 0.6);
}

.btn-primary:hover::before {
    left: 100%;
}

.btn-secondary {
    background: rgba(255, 255, 255, 0.15);
    color: white;
    border: 2px solid rgba(255, 255, 255, 0.3);
    padding: 16px 40px;
    border-radius: 50px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1.1rem;
    backdrop-filter: blur(10px);
}

.btn-secondary:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(255, 255, 255, 0.2);
}

.image-preview {
    width: 100%;
    max-width: 600px;
    text-align: center;
    margin-top: 25px;
}

#previewImage {
    max-width: 100%;
    max-height: 400px;
    border-radius: 20px;
    margin-bottom: 25px;
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
    border: 3px solid rgba(255, 255, 255, 0.2);
}

.image-actions {
    display: flex;
    gap: 20px;
    justify-content: center;
}

.analysis-progress {
    margin: 25px 0;
    text-align: center;
}

.progress-bar {
    height: 12px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
}

.progress-fill {
    height: 100%;
    background: var(--gradient-accent);
    width: 0%;
    transition: width 0.5s ease;
    box-shadow: 0 2px 10px rgba(0, 172, 193, 0.5);
    position: relative;
    overflow: hidden;
}

.progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    background: linear-gradient(90deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
    animation: shimmer 2s infinite;
}

.analysis-details {
    background: var(--gradient-card);
    backdrop-filter: blur(15px);
    border-radius: 20px;
    padding: 30px;
    margin-top: 25px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.detection-item {
    display: flex;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    transition: background 0.3s ease;
    border-radius: 15px;
}

.detection-item:hover {
    background: rgba(255, 255, 255, 0.1);
}

.detection-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: var(--gradient-accent);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 25px;
    font-size: 1.5rem;
    box-shadow: 0 4px 15px rgba(0, 172, 193, 0.4);
}

.detection-content {
    flex: 1;
}

.detection-confidence {
    width: 150px;
    height: 10px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 5px;
    overflow: hidden;
    margin-top: 10px;
}

.confidence-fill {
    height: 100%;
    background: var(--success);
    border-radius: 5px;
    box-shadow: 0 2px 8px rgba(0, 200, 83, 0.4);
}

.analysis-loading {
    text-align: center;
    padding: 50px;
}

.spinner {
    width: 60px;
    height: 60px;
    border: 4px solid rgba(255, 255, 255, 0.2);
    border-left-color: var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 25px;
    box-shadow: 0 4px 15px rgba(0, 172, 193, 0.4);
}


.emergency-buttons {
    display: flex;
    justify-content: center;
    gap: 35px;
    margin: 50px 0;
    flex-wrap: wrap;
}

.emergency-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 200px;
    height: 200px;
    border-radius: 30px;
    background: var(--gradient-card);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 30px;
    text-align: center;
    animation: float 4s ease-in-out infinite;
    position: relative;
    overflow: hidden;
}

.emergency-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.emergency-btn:hover {
    transform: translateY(-10px) scale(1.05);
    box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
}

.emergency-btn:hover::before {
    opacity: 1;
}

.emergency-btn i {
    font-size: 3.5rem;
    margin-bottom: 25px;
    text-shadow: 0 4px 15px rgba(0,0,0,0.3);
}

.earthquake-btn {
    color: #FF6B6B;
}

.numbers-btn {
    color: #4FC3F7;
}

.btn-text {
    font-weight: 700;
    font-size: 1.2rem;
    margin-bottom: 12px;
    color: white;
}

.btn-status {
    font-size: 0.9rem;
    margin-top: 10px;
    opacity: 0.9;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.8);
}

.emergency-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(13, 71, 161, 0.9);
    backdrop-filter: blur(10px);
    z-index: 10000;
    justify-content: center;
    align-items: center;
}

.modal-content {
    background: var(--gradient-card);
    backdrop-filter: blur(25px);
    border-radius: 30px;
    padding: 40px;
    width: 90%;
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 25px 60px rgba(0, 0, 0, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.2);
    position: relative;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    padding-bottom: 25px;
}

.modal-header h2 {
    color: white;
    display: flex;
    align-items: center;
    gap: 15px;
    font-size: 1.8rem;
    font-weight: 700;
}

.close-modal {
    background: none;
    border: none;
    font-size: 2rem;
    cursor: pointer;
    color: rgba(255, 255, 255, 0.7);
    transition: color 0.3s ease;
}

.close-modal:hover {
    color: white;
    transform: scale(1.1);
}

.emergency-list {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.emergency-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
    overflow: hidden;
}

.emergency-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.emergency-item:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateX(8px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
}

.emergency-item:hover::before {
    opacity: 1;
}

.emergency-info {
    display: flex;
    flex-direction: column;
    flex: 1;
}

.emergency-name {
    font-weight: 700;
    color: white;
    font-size: 1.3rem;
}

.emergency-description {
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.8);
    margin-top: 5px;
}

.emergency-number {
    font-weight: 800;
    color: #FF6B6B;
    font-size: 1.5rem;
    margin: 0 20px;
    text-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

.call-btn {
    background: var(--gradient-accent);
    color: white;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 172, 193, 0.4);
    font-size: 1.2rem;
}

.call-btn:hover {
    background: var(--accent);
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(0, 172, 193, 0.6);
}

.earthquake-alert {
    position: fixed;
    top: 35px;
    right: 35px;
    background: linear-gradient(135deg, #E53935 0%, #B71C1C 100%);
    color: white;
    padding: 25px 30px;
    border-radius: 20px;
    box-shadow: 0 15px 40px rgba(229, 57, 53, 0.5);
    z-index: 1000;
    display: none;
    animation: shake 0.8s ease-in-out infinite;
    max-width: 380px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(10px);
}

.alert-content {
    display: flex;
    align-items: center;
    gap: 20px;
}

.alert-content i {
    font-size: 1.8rem;
}

.close-alert {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    margin-left: 20px;
    font-size: 1.5rem;
    transition: transform 0.3s ease;
}

.close-alert:hover {
    transform: scale(1.2);
}

/* ===== TOGGLE SWITCH MEJORADO ===== */
.toggle-switch {
    position: relative;
    display: inline-block;
    width: 70px;
    height: 35px;
    margin-top: 15px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.2);
    transition: .4s;
    border-radius: 34px;
    box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.slider:before {
    position: absolute;
    content: "";
    height: 27px;
    width: 27px;
    left: 4px;
    bottom: 3px;
    background: white;
    transition: .4s;
    border-radius: 50%;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

input:checked + .slider {
    background: var(--success);
}

input:checked + .slider:before {
    transform: translateX(35px);
}


.crack-analysis {
    margin-top: 30px;
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.analysis-canvas-container {
    display: flex;
    justify-content: center;
    gap: 30px;
    flex-wrap: wrap;
}

.canvas-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    background: var(--gradient-card);
    backdrop-filter: blur(15px);
    padding: 25px;
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
}

.canvas-wrapper h4 {
    margin-bottom: 20px;
    color: white;
    font-weight: 600;
    font-size: 1.3rem;
}

.analysis-canvas {
    border: 3px solid var(--accent);
    border-radius: 15px;
    max-width: 100%;
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
}

.crack-details {
    background: var(--gradient-card);
    backdrop-filter: blur(15px);
    padding: 25px;
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
}

.crack-metrics {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 25px;
    margin-top: 25px;
}

.metric-card {
    background: rgba(255, 255, 255, 0.1);
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    text-align: center;
    transition: transform 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
    overflow: hidden;
}

.metric-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.metric-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
}

.metric-card:hover::before {
    opacity: 1;
}

.metric-value {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--accent);
    margin: 15px 0;
    text-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

.metric-label {
    font-size: 1.1rem;
    color: rgba(255, 255, 255, 0.9);
    font-weight: 500;
}


.results-section {
    background: var(--gradient-card);
    backdrop-filter: blur(25px);
    border-radius: 25px;
    padding: 35px;
    margin-top: 35px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
}

.results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 40px;
    padding-bottom: 25px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}

.results-header h2 {
    font-size: 2.5rem;
    color: white;
    font-weight: 700;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.risk-badge {
    padding: 15px 30px;
    border-radius: 35px;
    font-weight: 700;
    font-size: 1.3rem;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
}

.high-risk { 
    background: linear-gradient(135deg, #E53935 0%, #B71C1C 100%); 
}
.medium-risk { 
    background: linear-gradient(135deg, #FF8F00 0%, #E65100 100%); 
}
.low-risk { 
    background: linear-gradient(135deg, #00C853 0%, #1B5E20 100%); 
}

.results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 35px;
}

.result-card {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: transform 0.3s ease;
    position: relative;
    overflow: hidden;
}

.result-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.result-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
}

.result-card:hover::before {
    opacity: 1;
}

.result-card h3 {
    font-size: 1.5rem;
    margin-bottom: 25px;
    color: white;
    display: flex;
    align-items: center;
    gap: 15px;
    font-weight: 600;
}

.vulnerabilities-list, .evacuation-routes, .improvement-tips {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.vulnerability-item, .route-item, .tip-item {
    padding: 20px;
    border-radius: 15px;
    background: rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
    border-left: 6px solid;
    position: relative;
    overflow: hidden;
}

.vulnerability-item::before, .route-item::before, .tip-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 50%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.vulnerability-item:hover, .route-item:hover, .tip-item:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateX(8px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
}

.vulnerability-item:hover::before, .route-item:hover::before, .tip-item:hover::before {
    opacity: 1;
}

.vulnerability-item {
    border-left-color: #E53935;
}

.route-item {
    border-left-color: #00ACC1;
}

.tip-item {
    border-left-color: #00C853;
}

.vulnerability-item h4, .route-item h4, .tip-item h4 {
    margin-bottom: 12px;
    color: white;
    font-weight: 600;
    font-size: 1.2rem;
}

.vulnerability-item p, .route-item p, .tip-item p {
    color: rgba(255, 255, 255, 0.9);
    font-size: 1.05rem;
    line-height: 1.6;
}

.chatbot-toggle {
    position: fixed;
    bottom: 35px;
    right: 35px;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: var(--gradient-accent);
    border: none;
    color: white;
    cursor: pointer;
    box-shadow: 0 12px 35px rgba(0, 172, 193, 0.5);
    z-index: 1000;
    transition: all 0.3s ease;
    animation: float 3s ease-in-out infinite;
    font-size: 1.8rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

.chatbot-toggle:hover {
    transform: scale(1.15);
    box-shadow: 0 18px 45px rgba(0, 172, 193, 0.7);
}

.chatbot-widget {
    position: fixed;
    bottom: 135px;
    right: 35px;
    width: 400px;
    height: 600px;
    background: var(--gradient-card);
    border-radius: 30px;
    box-shadow: 0 25px 60px rgba(0, 0, 0, 0.4);
    z-index: 1000;
    display: none;
    flex-direction: column;
    overflow: hidden;
    border: 1px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(20px);
}

.chatbot-widget.active {
    display: flex;
}

.chatbot-header {
    background: var(--gradient-header);
    color: white;
    padding: 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}

.chatbot-header h4 {
    margin: 0;
    display: flex;
    align-items: center;
    gap: 15px;
    font-size: 1.3rem;
    font-weight: 600;
}

.chatbot-close {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    font-size: 1.5rem;
    transition: transform 0.3s ease;
}

.chatbot-close:hover {
    transform: scale(1.2);
}

.chatbot-messages {
    flex: 1;
    padding: 25px;
    overflow-y: auto;
    background: rgba(255, 255, 255, 0.05);
}

.chat-message {
    margin-bottom: 20px;
    display: flex;
}

.bot-message {
    justify-content: flex-start;
}

.user-message {
    justify-content: flex-end;
}

.message-content {
    max-width: 85%;
    padding: 18px 22px;
    border-radius: 25px;
    font-size: 1.05rem;
    line-height: 1.5;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.bot-message .message-content {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-bottom-left-radius: 8px;
    color: white;
}

.user-message .message-content {
    background: var(--gradient-accent);
    color: white;
    border-bottom-right-radius: 8px;
    box-shadow: 0 4px 15px rgba(0, 172, 193, 0.4);
}

.chatbot-input {
    display: flex;
    padding: 25px;
    background: rgba(255, 255, 255, 0.1);
    border-top: 1px solid rgba(255, 255, 255, 0.2);
    gap: 15px;
}

.chatbot-input input {
    flex: 1;
    padding: 18px 22px;
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 25px;
    outline: none;
    font-size: 1.1rem;
    transition: border-color 0.3s ease;
    background: rgba(255, 255, 255, 0.1);
    color: white;
}

.chatbot-input input::placeholder {
    color: rgba(255, 255, 255, 0.7);
}

.chatbot-input input:focus {
    border-color: var(--accent);
    background: rgba(255, 255, 255, 0.15);
}

.chatbot-input button {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: none;
    background: var(--gradient-accent);
    color: white;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1.2rem;
    box-shadow: 0 4px 15px rgba(0, 172, 193, 0.4);
}

.chatbot-input button:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(0, 172, 193, 0.6);
}

.voice-listening {
    animation: pulse 1.5s infinite;
    background: linear-gradient(135deg, #E53935 0%, #B71C1C 100%) !important;
}


.footer-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
}

.footer-brand h3 {
    font-size: 1.8rem;
    color: white;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 15px;
    font-weight: 700;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.footer-brand p {
    color: rgba(255, 255, 255, 0.9);
    font-size: 1.1rem;
}

.footer-links {
    display: flex;
    gap: 30px;
}

.footer-links a {
    color: rgba(255, 255, 255, 0.8);
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s ease;
    font-weight: 500;
    font-size: 1.1rem;
}

.footer-links a:hover {
    color: white;
    transform: translateY(-3px);
    text-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

.footer-bottom {
    text-align: center;
    padding-top: 30px;
    border-top: 1px solid rgba(255, 255, 255, 0.2);
    color: rgba(255, 255, 255, 0.8);
    font-size: 1.05rem;
}

.hidden {
    display: none !important;
}

.text-center {
    text-align: center;
}

.mt-20 {
    margin-top: 20px;
}

.mb-20 {
    margin-bottom: 20px;
}

/* ===== RESPONSIVE DESIGN ===== */
@media (max-width: 768px) {
    .container {
        width: 95%;
        padding: 15px;
    }
    
    .header-content h1 {
        font-size: 2.2rem;
    }
    
    .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 20px;
    }
    
    .slider-nav {
        align-self: flex-end;
    }
    
    .recommendation-slider {
        height: 300px;
    }
    
    .map-container {
        height: 400px;
    }
    
    .map-overlay {
        position: static;
        flex-direction: row;
        justify-content: center;
        margin-top: 20px;
    }
    
    .map-legend {
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .emergency-buttons {
        flex-direction: column;
        align-items: center;
        gap: 25px;
    }
    
    .emergency-btn {
        width: 180px;
        height: 180px;
    }
    
    .results-grid {
        grid-template-columns: 1fr;
        gap: 25px;
    }
    
    .results-header {
        flex-direction: column;
        gap: 20px;
        text-align: center;
    }
    
    .footer-content {
        flex-direction: column;
        gap: 30px;
        text-align: center;
    }
    
    .footer-links {
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .chatbot-widget {
        width: 90%;
        right: 5%;
        height: 550px;
    }
    
    .chatbot-toggle {
        width: 70px;
        height: 70px;
        bottom: 25px;
        right: 25px;
    }
    
    .analysis-canvas-container {
        flex-direction: column;
        align-items: center;
    }
    
    .canvas-wrapper {
        width: 100%;
        max-width: 400px;
    }
    
    .crack-metrics {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .header-content h1 {
        font-size: 1.8rem;
    }
    
    .search-box {
        flex-direction: column;
        gap: 12px;
        padding: 12px;
    }
    
    .search-box input {
        border-radius: 25px;
    }
    
    .search-box button {
        width: 100%;
        border-radius: 25px;
        margin-left: 0;
    }
    
    .upload-area {
        padding: 40px 25px;
    }
    
    .image-actions {
        flex-direction: column;
        gap: 12px;
    }
    
    .btn-primary, .btn-secondary {
        width: 100%;
    }
    
    .modal-content {
        padding: 30px 25px;
        margin: 15px;
    }
    
    .emergency-item {
        flex-direction: column;
        gap: 20px;
        text-align: center;
    }
    
    .emergency-number {
        margin: 0;
    }
}
    </style>
</head>
<body>

    <header class="glass-header">
        <div class="container">
            <div class="header-content">
                <h1><i class="fas fa-shield-alt"></i> SafeHome</h1>
                <p>Protecci√≥n inteligente para tu hogar</p>
            </div>

            <div class="search-container">
                <div class="search-box">
                    <input type="text" id="globalSearch" placeholder="Buscar recomendaciones, emergencias, grietas...">
                    <button id="globalSearchBtn"><i class="fas fa-search"></i></button>
                    <button id="globalVoiceSearchBtn"><i class="fas fa-microphone"></i></button>
                </div>
            </div>

            <div class="risk-meter">
                <div class="risk-level" id="globalRiskLevel">
                    <span>Riesgo Actual: </span>
                    <strong>Moderado</strong>
                </div>
                <div class="risk-visual">
                    <div class="risk-bar" id="riskBar"></div>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
 
        <section class="slider-section">
            <div class="section-header">
                <h2>Recomendaciones para tu hogar</h2>
                <div class="slider-nav">
                    <button class="slider-prev"><i class="fas fa-chevron-left"></i></button>
                    <button class="slider-next"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            <div class="swiper recommendation-slider">
                <div class="swiper-wrapper" id="recommendationSlider">

                </div>
                <div class="swiper-pagination"></div>
            </div>
        </section>


<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap');

    .slider-container {
        position: relative;
        width: 95%;
        max-width: 1200px; 
        margin: 40px auto;
        overflow: hidden;
        border-radius: 20px;
        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        font-family: 'Inter', sans-serif;
    }

    .slide {
        position: absolute;
        width: 100%;
        height: 100%;
        opacity: 0;
        transition: opacity 1.4s ease-in-out;
    }

    .slide.active {
        opacity: 1;
        position: relative;
    }

    .slide img {
        width: 100%;
        height: 480px;  
        object-fit: cover;
    }

    .caption-gradient {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 35%;
        background: linear-gradient(transparent, rgba(0,0,0,0.7));
    }

    .caption {
        position: absolute;
        bottom: 25px;
        left: 25px;
        color: white;
        font-size: 1.6em;
        font-weight: 600;
        max-width: 75%;
        line-height: 1.3;
        text-shadow: 0 4px 10px rgba(0,0,0,0.7);
    }

    @media (max-width: 900px) {
        .slide img {
            height: 380px;
        }
        .caption {
            font-size: 1.3em;
        }
    }

    @media (max-width: 600px) {
        .slide img {
            height: 300px;
        }
        .caption {
            font-size: 1.15em;
        }
    }
</style>

<div class="slider-container">

  
    <div class="slide active">
        <img src="https://images.unsplash.com/photo-1598403038688-78de1a971b04?auto=format&fit=crop&w=1200&q=80" />
        <div class="caption-gradient"></div>
        <div class="caption">Detecci√≥n autom√°tica de grietas mediante IA</div>
    </div>

    <div class="slide">
        <img src="https://pyhca.com/wp-content/uploads/2023/11/inspeccion-calidad-construccion.jpg" />
        <div class="caption-gradient"></div>
        <div class="caption">Eval√∫a el estado de paredes, pisos y estructuras</div>
    </div>

 
    <div class="slide">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSGFWj9nLnzmDcxJ73Qnj2K8R0noG5jU7caig&s" />
        <div class="caption-gradient"></div>
        <div class="caption">Alertas meteorol√≥gicas en tiempo real para tu seguridad</div>
    </div>

   
    <div class="slide">
        <img src="https://www.nextiva.com/cdn-cgi/image/width=1280,height=720,fit=cover,gravity=auto,format=auto/blog/wp-content/uploads/sites/10/2024/11/Chatbot-Call-Center.webp?resize=1024,576" />
        <div class="caption-gradient"></div>
        <div class="caption">ChatBot inteligente con recomendaciones precisas</div>
    </div>

    <div class="slide">
        <img src="https://www.tecnoseguro.com/media/k2/items/cache/88ef4947bc838e25afe26677036db057_XL.jpg" />
        <div class="caption-gradient"></div>
        <div class="caption">Prevenci√≥n de riesgos y monitoreo del ambiente</div>
    </div>

</div>

<script>
    let index = 0;
    const slides = document.querySelectorAll(".slide");

    function showNextSlide() {
        slides[index].classList.remove("active");
        index = (index + 1) % slides.length;
        slides[index].classList.add("active");
    }

    setInterval(showNextSlide, 4800); 
</script>
       
        <section class="map-section">
            <div class="section-header">
                <h2>Mapa de Riesgos</h2>
                <div class="map-controls">
                    <div class="map-legend">
                        <div class="legend-item"><span class="legend-high"></span> Alto</div>
                        <div class="legend-item"><span class="legend-medium"></span> Medio</div>
                        <div class="legend-item"><span class="legend-low"></span> Bajo</div>
                    </div>
                </div>
            </div>
            <div class="map-container">
                <div id="riskMap"></div>
                <div class="map-overlay">
                    <button id="locateMe"><i class="fas fa-location-arrow"></i> Mi ubicaci√≥n</button>
                </div>
            </div>
        </section>


       
        <section class="upload-section glass-card">
            <h2>Analiza tu propiedad</h2>
            <p class="analysis-info">Sube una foto de tu casa para detectar grietas, da√±os estructurales y recibir recomendaciones personalizadas.</p>
            
            <div class="upload-container">
                <div class="upload-area" id="uploadArea">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Arrastra una foto de tu casa aqu√≠ o haz clic para seleccionar</p>
                    <input type="file" id="fileInput" accept="image/*">
                    <button class="btn-primary">Seleccionar archivo</button>
                </div>
                <div class="image-preview hidden" id="imagePreview">
                    <img id="previewImage" src="" alt="Vista previa">
                    <div class="image-actions">
                        <button id="analyzeBtn" class="btn-primary">Analizar imagen</button>
                        <button id="cancelBtn" class="btn-secondary">Cancelar</button>
                    </div>
                </div>
            </div>


        
            <div class="analysis-progress hidden" id="analysisProgress">
                <h3>Analizando imagen...</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="progressText">Preparando modelo de IA</p>
            </div>

   
            <div class="analysis-details hidden" id="analysisDetails">
                <h3>Detalles del an√°lisis</h3>
                <div id="detectionResults"></div>
            </div>

            <div class="crack-analysis hidden" id="crackAnalysis">
                <h3>An√°lisis detallado de grietas</h3>
                <div class="analysis-canvas-container">
                    <div class="canvas-wrapper">
                        <h4>Imagen original</h4>
                        <canvas id="originalCanvas" class="analysis-canvas"></canvas>
                    </div>
                    <div class="canvas-wrapper">
                        <h4>Grietas detectadas</h4>
                        <canvas id="crackCanvas" class="analysis-canvas"></canvas>
                    </div>
                </div>
                
                <div class="crack-details">
                    <h4>M√©tricas de grietas detectadas</h4>
                    <div class="crack-metrics">
                        <div class="metric-card">
                            <div class="metric-value" id="crackCount">0</div>
                            <div class="metric-label">Grietas detectadas</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="crackLength">0 cm</div>
                            <div class="metric-label">Longitud total</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="crackSeverity">Baja</div>
                            <div class="metric-label">Severidad</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="emergency-buttons-section">
            <div class="section-header">
                <h2>Alertas y Emergencias</h2>
                <p>Mantente informado y preparado ante cualquier situaci√≥n</p>
            </div>
            <div class="emergency-buttons">
                <div class="emergency-btn earthquake-btn" id="earthquakeBtn">
                    <i class="fas fa-seedling"></i>
                    <span class="btn-text">Alertas S√≠smicas</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="earthquakeToggle">
                        <span class="slider"></span>
                    </label>
                    <span class="btn-status" id="earthquakeStatus">Inactivo</span>
                </div>
                
                <div class="emergency-btn numbers-btn" id="emergencyNumbersBtn">
                    <i class="fas fa-phone-alt"></i>
                    <span class="btn-text">N√∫meros de Emergencia</span>
                    <div class="btn-status">Ver contactos</div>
                </div>
            </div>
        </section>

        <section class="results-section hidden glass-card" id="resultsSection">
            <div class="results-header">
                <h2>Resultados del an√°lisis</h2>
                <div class="risk-badge" id="riskBadge">Riesgo Moderado</div>
            </div>
            <div class="results-grid">
                <div class="result-card">
                    <h3><i class="fas fa-exclamation-triangle"></i> Vulnerabilidades</h3>
                    <div class="vulnerabilities-list" id="vulnerabilitiesList"></div>
                </div>
                <div class="result-card">
                    <h3><i class="fas fa-route"></i> Rutas de evacuaci√≥n</h3>
                    <div class="evacuation-routes" id="evacuationRoutes"></div>
                </div>
                <div class="result-card">
                    <h3><i class="fas fa-lightbulb"></i> Recomendaciones</h3>
                    <div class="improvement-tips" id="improvementTips"></div>
                </div>
            </div>
        </section>
    </main>


    <div class="emergency-modal" id="emergencyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-phone-alt"></i> N√∫meros de Emergencia</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="emergency-list">
                <div class="emergency-item">
                    <div class="emergency-info">
                        <span class="emergency-name">Emergencias General</span>
                        <span class="emergency-description">Polic√≠a, bomberos, ambulancia</span>
                    </div>
                    <div class="emergency-number">911</div>
                    <button class="call-btn"><i class="fas fa-phone"></i></button>
                </div>
                <div class="emergency-item">
                    <div class="emergency-info">
                        <span class="emergency-name">Cruz Roja</span>
                        <span class="emergency-description">Ambulancias y primeros auxilios</span>
                    </div>
                    <div class="emergency-number">53 95 11 11</div>
                    <button class="call-btn"><i class="fas fa-phone"></i></button>
                </div>
                <div class="emergency-item">
                    <div class="emergency-info">
                        <span class="emergency-name">Protecci√≥n Civil</span>
                        <span class="emergency-description">Emergencias y desastres naturales</span>
                    </div>
                    <div class="emergency-number">56 83 22 22</div>
                    <button class="call-btn"><i class="fas fa-phone"></i></button>
                </div>
                <div class="emergency-item">
                    <div class="emergency-info">
                        <span class="emergency-name">Bomberos</span>
                        <span class="emergency-description">Incendios y rescates</span>
                    </div>
                    <div class="emergency-number">57 84 2124</div>
                    <button class="call-btn"><i class="fas fa-phone"></i></button>
                </div>
                <div class="emergency-item">
                    <div class="emergency-info">
                        <span class="emergency-name">Atenci√≥n M√©dica</span>
                        <span class="emergency-description">Urgencias m√©dicas 24/7</span>
                    </div>
                    <div class="emergency-number">55 12 34 56</div>
                    <button class="call-btn"><i class="fas fa-phone"></i></button>
                </div>
            </div>
        </div>
  
    <div class="earthquake-alert" id="earthquakeAlert">
        <div class="alert-content">
            <i class="fas fa-exclamation-triangle"></i>
            <div>
                <strong>Alerta S√≠smica Activada</strong>
                <p>Se ha detectado actividad s√≠smica en tu zona. Toma precauciones.</p>
            </div>
        </div>
        <button class="close-alert">&times;</button>
    </div>

    <div class="chatbot-widget" id="chatbotWidget">
        <div class="chatbot-header">
            <h4><i class="fas fa-robot"></i> Asistente SafeHome</h4>
            <button class="chatbot-close" id="chatbotClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="chatbot-messages" id="chatbotMessages">
            <div class="chat-message bot-message">
                <div class="message-content">
                    ¬°Hola! üëã Soy tu asistente de SafeHome.<br><br>
                    Puedo ayudarte con:<br>
                    ‚Ä¢ üì∏ <strong>An√°lisis de grietas</strong><br>
                    ‚Ä¢ üè† <strong>Recomendaciones estructurales</strong><br>
                    ‚Ä¢ üö® <strong>Protocolos de emergencia</strong><br>
                    ‚Ä¢ üó∫Ô∏è <strong>Rutas de evacuaci√≥n</strong><br>
                    ‚Ä¢ üìã <strong>Kits de seguridad</strong><br><br>
                    ¬øEn qu√© puedo asistirte hoy?
                </div>
            </div>
        </div>
        <div class="chatbot-input">
            <input type="text" id="chatbotInput" placeholder="Escribe tu pregunta...">
            <button id="chatbotSend"><i class="fas fa-paper-plane"></i></button>
            <button id="voiceSearchBtn"><i class="fas fa-microphone"></i></button>
        </div>
    </div>


    <button class="chatbot-toggle" id="chatbotToggle">
        <i class="fas fa-robot"></i>
    </button>

  
    <footer class="glass-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <h3><i class="fas fa-shield-alt"></i> SafeHome</h3>
                    <p>Protecci√≥n inteligente contra desastres naturales</p>
                </div>
                <div class="footer-links">
                    <a href="#"><i class="fas fa-info-circle"></i> Acerca de</a>
                    <a href="#"><i class="fas fa-envelope"></i> Contacto</a>
                    <a href="#"><i class="fas fa-shield-alt"></i> Privacidad</a>
                    <a href="#"><i class="fas fa-file-alt"></i> T√©rminos</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>¬© 2025 SafeHome. Todos los derechos reservados. | Protegiendo hogares, salvando vidas.</p>
            </div>
        </div>
    </footer>


    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/8.0.0/swiper-bundle.min.js"></script>
    

    <script>

        class SafeHomeApp {
            constructor() {
                this.map = null;
                this.swiper = null;
                this.chatbot = null;
                this.isListening = false;
                this.recognition = null;
                this.currentAnalysis = null;
                this.earthquakeAlertsActive = false;
                this.contentLoaded = false;
                
                this.init();
            }

         
            init() {
                this.initSwiper();
                this.initMap();
                this.initChatbot();
                this.initVoiceRecognition();
                this.setupEventListeners();
                this.loadSampleData();
            }

            initSwiper() {
                this.swiper = new Swiper('.recommendation-slider', {
                    slidesPerView: 1,
                    spaceBetween: 20,
                    pagination: {
                        el: '.swiper-pagination',
                        clickable: true,
                        dynamicBullets: true
                    },
                    navigation: {
                        nextEl: '.slider-next',
                        prevEl: '.slider-prev',
                    },
                    breakpoints: {
                        640: {
                            slidesPerView: 1,
                        },
                        768: {
                            slidesPerView: 2,
                        },
                        1024: {
                            slidesPerView: 3,
                        }
                    },
                    autoplay: {
                        delay: 5000,
                        disableOnInteraction: false,
                    },
                    effect: 'slide',
                    speed: 600
                });
            }

    
            initMap() {
           
                this.map = L.map('riskMap').setView([19.4326, -99.1332], 12);
                
             
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    maxZoom: 18
                }).addTo(this.map);

             
                this.addRiskZones();
                
            
                this.setupGeolocation();
            }

            addRiskZones() {
               
                const highRiskZone = L.circle([19.4326, -99.1332], {
                    color: '#EF476F',
                    fillColor: '#EF476F',
                    fillOpacity: 0.3,
                    radius: 800
                }).addTo(this.map).bindPopup(`
                    <div class="risk-popup">
                        <h4>üö® Zona de Alto Riesgo</h4>
                        <p><strong>Inundaciones frecuentes</strong></p>
                        <p>Nivel de riesgo: Alto</p>
                        <p>Recomendaci√≥n: Evacuar en temporada de lluvias</p>
                    </div>
                `);

                const mediumRiskZone = L.circle([19.4285, -99.1276], {
                    color: '#FF9E00',
                    fillColor: '#FF9E00',
                    fillOpacity: 0.3,
                    radius: 600
                }).addTo(this.map).bindPopup(`
                    <div class="risk-popup">
                        <h4>‚ö†Ô∏è Zona de Riesgo Medio</h4>
                        <p><strong>Vientos fuertes</strong></p>
                        <p>Nivel de riesgo: Medio</p>
                        <p>Recomendaci√≥n: Asegurar objetos exteriores</p>
                    </div>
                `);

                const lowRiskZone = L.circle([19.4360, -99.1390], {
                    color: '#06D6A0',
                    fillColor: '#06D6A0',
                    fillOpacity: 0.3,
                    radius: 500
                }).addTo(this.map).bindPopup(`
                    <div class="risk-popup">
                        <h4>‚úÖ Zona de Bajo Riesgo</h4>
                        <p><strong>Estable</strong></p>
                        <p>Nivel de riesgo: Bajo</p>
                        <p>Recomendaci√≥n: Mantener medidas preventivas</p>
                    </div>
                `);
            }

            setupGeolocation() {
                const locateButton = document.getElementById('locateMe');
                
                locateButton.addEventListener('click', () => {
                    this.map.locate({ 
                        setView: true, 
                        maxZoom: 16,
                        enableHighAccuracy: true 
                    });
                });

                this.map.on('locationfound', (e) => {
                    const radius = e.accuracy / 2;
                    
                    L.marker(e.latlng)
                        .addTo(this.map)
                        .bindPopup(`<b>Tu ubicaci√≥n actual</b><br>Precisi√≥n: ${radius.toFixed(1)} metros`)
                        .openPopup();
                    
                    L.circle(e.latlng, radius)
                        .addTo(this.map);
                        
                
                    this.getWeatherAlerts(e.latlng.lat, e.latlng.lng);
                });

                this.map.on('locationerror', (e) => {
                    alert('No se pudo obtener tu ubicaci√≥n. Aseg√∫rate de permitir el acceso a la ubicaci√≥n.');
                    console.error('Error de geolocalizaci√≥n:', e.message);
                });
            }

          
            initChatbot() {
                this.setupChatbotUI();
                this.setupChatbotResponses();
            }

            setupChatbotUI() {
                const chatbotToggle = document.getElementById('chatbotToggle');
                const chatbotClose = document.getElementById('chatbotClose');
                const chatbotSend = document.getElementById('chatbotSend');
                const chatbotInput = document.getElementById('chatbotInput');
                const voiceSearchBtn = document.getElementById('voiceSearchBtn');

      
                chatbotToggle.addEventListener('click', () => {
                    this.toggleChatbot();
                });

                chatbotClose.addEventListener('click', () => {
                    this.closeChatbot();
                });

               
                chatbotSend.addEventListener('click', () => {
                    this.sendChatbotMessage();
                });

                chatbotInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.sendChatbotMessage();
                    }
                });

           
                voiceSearchBtn.addEventListener('click', () => {
                    this.toggleVoiceSearch('chatbot');
                });

                
                const globalVoiceSearchBtn = document.getElementById('globalVoiceSearchBtn');
                if (globalVoiceSearchBtn) {
                    globalVoiceSearchBtn.addEventListener('click', () => {
                        this.toggleVoiceSearch('global');
                    });
                }

                const globalSearchBtn = document.getElementById('globalSearchBtn');
                const globalSearchInput = document.getElementById('globalSearch');
                
                if (globalSearchBtn && globalSearchInput) {
                    globalSearchBtn.addEventListener('click', () => {
                        this.performGlobalSearch(globalSearchInput.value);
                    });

                    globalSearchInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.performGlobalSearch(globalSearchInput.value);
                        }
                    });
                }
            }

            setupChatbotResponses() {
                this.chatbotResponses = {
                    'grieta': {
                        response: 'Para analizar grietas, sube una foto de la zona afectada en la secci√≥n "Analiza tu propiedad". Te dar√© recomendaciones espec√≠ficas seg√∫n el tipo y severidad de las grietas.',
                        actions: ['showUploadSection']
                    },
                    'emergencia': {
                        response: 'üö® PROTOCOLO DE EMERGENCIA üö®\n\n1. Mant√©n la calma\n2. Activa alertas s√≠smicas\n3. Contacta emergencias:\n   ‚Ä¢ Protecci√≥n Civil: 56 83 22 22\n   ‚Ä¢ Bomberos: 57 84 2124\n   ‚Ä¢ Cruz Roja: 53 95 11 11\n4. Sigue rutas de evacuaci√≥n',
                        actions: ['showEmergencyModal']
                    },
                    'estructura': {
                        response: 'üîß EVALUACI√ìN ESTRUCTURAL\n\nRecomendaciones:\n‚Ä¢ Revisar cimientos anualmente\n‚Ä¢ Verificar columnas y vigas\n‚Ä¢ Consultar ingeniero estructural\n‚Ä¢ Monitorear grietas existentes\n‚Ä¢ Realizar mantenimiento preventivo',
                        actions: []
                    },
                    'terremoto': {
                        response: 'üè¢ PROTOCOLO S√çSMICO\n\nANTES:\n‚Ä¢ Prepara kit de emergencia\n‚Ä¢ Identifica zonas seguras\n‚Ä¢ Fija muebles altos\n\n**DURANTE:**\n‚Ä¢ Prot√©gete bajo marcos/mesas\n‚Ä¢ Al√©jate de ventanas\n‚Ä¢ No uses ascensores\n\n**DESPU√âS:**\n‚Ä¢ Revisa da√±os estructurales\n‚Ä¢ Evac√∫a si es necesario\n‚Ä¢ Reporta emergencias',
                        actions: []
                    },
                    'inundaci√≥n': {
                        response: 'üåä PREVENCI√ìN DE INUNDACIONES\n\n‚Ä¢ Instala barreras impermeables\n‚Ä¢ Mant√©n desag√ºes limpios\n‚Ä¢ Eleva equipos el√©ctricos\n‚Ä¢ Ten un plan de evacuaci√≥n\n‚Ä¢ Monitorea alertas meteorol√≥gicas',
                        actions: []
                    },
                    'kit': {
                        response: 'üéí KIT DE EMERGENCIA B√ÅSICO\n\n‚Ä¢ Agua (4L por persona/d√≠a)\n‚Ä¢ Alimentos no perecederos\n‚Ä¢ Botiqu√≠n de primeros auxilios\n‚Ä¢ Linterna y radio\n‚Ä¢ Documentos importantes\n‚Ä¢ Medicamentos\n‚Ä¢ Dinero en efectivo\n‚Ä¢ Manta t√©rmica',
                        actions: []
                    },
                    'analizar': {
                        response: 'Para analizar tu propiedad:\n1. Ve a "Analiza tu propiedad"\n2. Sube una foto clara\n3. Espera el an√°lisis de IA\n4. Recibe recomendaciones personalizadas\n\n¬øQuieres que te gu√≠e paso a paso?',
                        actions: ['showUploadSection']
                    },
                    'hola': {
                        response: '¬°Hola! üëã Soy tu asistente de SafeHome.\n\nPuedo ayudarte con:\n‚Ä¢ üì∏ An√°lisis de grietas\n‚Ä¢ üè† Recomendaciones estructurales\n‚Ä¢ üö® Protocolos de emergencia\n‚Ä¢ üó∫Ô∏è Rutas de evacuaci√≥n\n‚Ä¢ üìã Kits de seguridad\n\n¬øEn qu√© puedo asistirte hoy?',
                        actions: []
                    },
                    'gracias': {
                        response: '¬°De nada! üòä Estoy aqu√≠ para ayudarte a mantener tu hogar seguro.\n\nRecuerda: La prevenci√≥n es la mejor protecci√≥n. ¬øEn qu√© m√°s puedo ayudarte?',
                        actions: []
                    },
                    'default': {
                        response: 'Puedo ayudarte con:\n\n‚Ä¢ **An√°lisis de grietas** - Sube fotos para evaluaci√≥n\n‚Ä¢ **Recomendaciones estructurales** - Mejora la seguridad de tu hogar\n‚Ä¢ **Preparaci√≥n para emergencias** - Protocolos y kits\n‚Ä¢ **Alertas meteorol√≥gicas** - Monitoreo en tiempo real\n\n¬øEn qu√© aspecto espec√≠fico necesitas ayuda?',
                        actions: []
                    }
                };
            }

            toggleChatbot() {
                const widget = document.getElementById('chatbotWidget');
                widget.classList.toggle('active');
                
                if (widget.classList.contains('active')) {
                    document.getElementById('chatbotInput').focus();
                }
            }

            closeChatbot() {
                const widget = document.getElementById('chatbotWidget');
                widget.classList.remove('active');
            }

            sendChatbotMessage() {
                const input = document.getElementById('chatbotInput');
                const message = input.value.trim();
                
                if (message) {
                    this.addChatMessage(message, 'user');
                    this.processChatbotMessage(message);
                    input.value = '';
                }
            }

            addChatMessage(text, sender) {
                const messagesContainer = document.getElementById('chatbotMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = `chat-message ${sender}-message`;
                
                messageDiv.innerHTML = `
                    <div class="message-content">${this.formatMessage(text)}</div>
                `;
                
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
          
                if (sender === 'bot') {
                    this.typewriterEffect(messageDiv.querySelector('.message-content'), text);
                }
            }

            typewriterEffect(element, text) {
                element.innerHTML = '';
                let i = 0;
                const speed = 20;
                
                function typeWriter() {
                    if (i < text.length) {
                        element.innerHTML += text.charAt(i);
                        i++;
                        setTimeout(typeWriter, speed);
                    }
                }
                typeWriter();
            }

            formatMessage(text) {

                return text
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/\n/g, '<br>')
                    .replace(/(‚Ä¢|‚ñ∂|‚úì)\s*(.*?)(?=\n|$)/g, '<span class="list-item">$1 $2</span>');
            }

            processChatbotMessage(message) {
                const lowerMessage = message.toLowerCase();
                let response = this.chatbotResponses.default;
                

                for (const [keyword, data] of Object.entries(this.chatbotResponses)) {
                    if (lowerMessage.includes(keyword) && keyword !== 'default') {
                        response = data;
                        break;
                    }
                }
                

                setTimeout(() => {
                    this.addChatMessage(response.response, 'bot');
                    

                    response.actions.forEach(action => {
                        this.executeChatbotAction(action);
                    });
                }, 1000);
            }

            executeChatbotAction(action) {
                switch(action) {
                    case 'showUploadSection':
                        document.querySelector('.upload-section').scrollIntoView({ 
                            behavior: 'smooth',
                            block: 'center'
                        });
                        break;
                    case 'showEmergencyModal':
                        this.showEmergencyModal();
                        break;
                }
            }


            initVoiceRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.lang = 'es-ES';
                    this.recognition.maxAlternatives = 1;

                    this.recognition.onstart = () => {
                        this.isListening = true;
                        this.updateVoiceUI(true);
                    };

                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        this.processVoiceInput(transcript);
                    };

                    this.recognition.onerror = (event) => {
                        console.error('Error en reconocimiento de voz:', event.error);
                        this.addChatMessage('Lo siento, hubo un error con el reconocimiento de voz. Intenta nuevamente.', 'bot');
                        this.stopVoiceSearch();
                    };

                    this.recognition.onend = () => {
                        this.stopVoiceSearch();
                    };
                } else {
                    console.warn('El reconocimiento de voz no es compatible con este navegador');
                }
            }

            toggleVoiceSearch(context = 'chatbot') {
                if (!this.recognition) {
                    alert('El reconocimiento de voz no est√° disponible en tu navegador.');
                    return;
                }

                if (this.isListening) {
                    this.recognition.stop();
                } else {
                    this.context = context;
                    this.recognition.start();
                }
            }

            updateVoiceUI(listening) {
                const voiceButtons = document.querySelectorAll('#voiceSearchBtn, #globalVoiceSearchBtn');
                
                voiceButtons.forEach(btn => {
                    if (listening) {
                        btn.classList.add('voice-listening');
                        btn.innerHTML = '<i class="fas fa-circle"></i>';
                    } else {
                        btn.classList.remove('voice-listening');
                        btn.innerHTML = '<i class="fas fa-microphone"></i>';
                    }
                });

                if (this.context === 'chatbot' && listening) {
                    this.addChatMessage('üé§ Escuchando... Habla ahora.', 'bot');
                }
            }

            stopVoiceSearch() {
                this.isListening = false;
                this.updateVoiceUI(false);
            }

            processVoiceInput(transcript) {
                if (this.context === 'chatbot') {
                    document.getElementById('chatbotInput').value = transcript;
                    this.addChatMessage(transcript, 'user');
                    this.processChatbotMessage(transcript);
                } else if (this.context === 'global') {
                    document.getElementById('globalSearch').value = transcript;
                    this.performGlobalSearch(transcript);
                }
            }

            performGlobalSearch(query) {
                if (!query.trim()) return;

                const lowerQuery = query.toLowerCase();
                
      
                if (lowerQuery.includes('grieta') || lowerQuery.includes('da√±o') || lowerQuery.includes('estructura')) {
                    document.querySelector('.upload-section').scrollIntoView({ behavior: 'smooth' });
                    this.showNotification('üîç Te llevo a la secci√≥n de an√°lisis de grietas');
                } else if (lowerQuery.includes('emergencia') || lowerQuery.includes('alerta') || lowerQuery.includes('terremoto')) {
                    this.showEmergencyModal();
                    this.showNotification('üö® Abriendo n√∫meros de emergencia');
                } else if (lowerQuery.includes('mapa') || lowerQuery.includes('riesgo') || lowerQuery.includes('zona')) {
                    document.querySelector('.map-section').scrollIntoView({ behavior: 'smooth' });
                    this.showNotification('üó∫Ô∏è Mostrando mapa de riesgos');
                } else if (lowerQuery.includes('recomendaci√≥n') || lowerQuery.includes('consejo') || lowerQuery.includes('tip')) {
                    document.querySelector('.slider-section').scrollIntoView({ behavior: 'smooth' });
                    this.showNotification('üí° Mostrando recomendaciones de seguridad');
                } else {

                    this.toggleChatbot();
                    setTimeout(() => {
                        this.addChatMessage(query, 'user');
                        this.processChatbotMessage(query);
                    }, 500);
                }
            }

         
            setupImageAnalysis() {
                const uploadArea = document.getElementById('uploadArea');
                const fileInput = document.getElementById('fileInput');
                const analyzeBtn = document.getElementById('analyzeBtn');
                const cancelBtn = document.getElementById('cancelBtn');

                uploadArea.addEventListener('click', () => fileInput.click());
                fileInput.addEventListener('change', (e) => this.handleFileSelect(e));
                cancelBtn.addEventListener('click', () => this.resetFileInput());
                analyzeBtn.addEventListener('click', () => this.analyzeImage());
            }

            handleFileSelect(e) {
                const file = e.target.files[0];
                if (!file) return;

                if (!file.type.match('image.*')) {
                    this.showNotification('‚ùå Por favor selecciona una imagen v√°lida', 'error');
                    return;
                }

                if (file.size > 16 * 1024 * 1024) {
                    this.showNotification('‚ùå La imagen es demasiado grande (m√°ximo 16MB)', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (event) => {
                    document.getElementById('previewImage').src = event.target.result;
                    document.getElementById('uploadArea').classList.add('hidden');
                    document.getElementById('imagePreview').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }

            resetFileInput() {
                document.getElementById('fileInput').value = '';
                document.getElementById('previewImage').src = '';
                document.getElementById('uploadArea').classList.remove('hidden');
                document.getElementById('imagePreview').classList.add('hidden');
                document.getElementById('analysisProgress').classList.add('hidden');
                document.getElementById('analysisDetails').classList.add('hidden');
                document.getElementById('crackAnalysis').classList.add('hidden');
                document.getElementById('resultsSection').classList.add('hidden');
            }

            async analyzeImage() {
                const file = document.getElementById('fileInput').files[0];
                if (!file) return;

                const analyzeBtn = document.getElementById('analyzeBtn');
                analyzeBtn.disabled = true;
                analyzeBtn.textContent = 'Analizando...';

                const progressFill = document.getElementById('progressFill');
                const progressText = document.getElementById('progressText');
                
                document.getElementById('analysisProgress').classList.remove('hidden');
                

                await this.simulateProgress(progressFill, progressText);
                
 
                await this.analyzeImageForCracks(file);
                
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = 'Analizar imagen';
            }

            simulateProgress(progressFill, progressText) {
                return new Promise((resolve) => {
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += Math.random() * 15;
                        if (progress > 100) progress = 100;
                        
                        progressFill.style.width = `${progress}%`;
                        
                        if (progress < 20) {
                            progressText.textContent = 'üîç Cargando modelo de IA...';
                        } else if (progress < 50) {
                            progressText.textContent = 'üè† Analizando estructuras...';
                        } else if (progress < 80) {
                            progressText.textContent = 'üìê Detectando grietas...';
                        } else {
                            progressText.textContent = 'üí° Generando recomendaciones...';
                        }
                        
                        if (progress >= 100) {
                            clearInterval(interval);
                            setTimeout(resolve, 500);
                        }
                    }, 300);
                });
            }

            async analyzeImageForCracks(file) {
                try {
                    const img = new Image();
                    img.src = URL.createObjectURL(file);
                    
                    img.onload = () => {
                        const origCtx = document.getElementById('originalCanvas').getContext('2d');
                        const crackCtx = document.getElementById('crackCanvas').getContext('2d');
                        
                  
                        const maxWidth = 500;
                        const ratio = Math.min(maxWidth / img.width, 1);
                        const canvasWidth = img.width * ratio;
                        const canvasHeight = img.height * ratio;
                        
                        [origCtx.canvas, crackCtx.canvas].forEach(canvas => {
                            canvas.width = canvasWidth;
                            canvas.height = canvasHeight;
                        });
               
                        origCtx.drawImage(img, 0, 0, canvasWidth, canvasHeight);
                        
                        
                        const crackData = this.detectCracks(origCtx, canvasWidth, canvasHeight);
                        
             
                        this.drawCracks(crackCtx, crackData, canvasWidth, canvasHeight);
                        
                    
                        this.updateCrackMetrics(crackData);
             
                        this.processAnalysisResults(crackData);
                    };
                    
                } catch (error) {
                    console.error('Error analizando imagen:', error);
                  
                    setTimeout(() => {
                        const mockData = {
                            points: Array(150).fill().map(() => ({
                                x: Math.random() * 500,
                                y: Math.random() * 500,
                                strength: Math.random() * 100,
                                intensity: Math.random() * 255
                            })),
                            totalLength: 245.67,
                            count: 8
                        };
                        this.processAnalysisResults(mockData);
                    }, 2000);
                }
            }

            detectCracks(ctx, width, height) {
                const imageData = ctx.getImageData(0, 0, width, height);
                const data = imageData.data;
                const cracks = [];
                let totalLength = 0;

                for (let y = 1; y < height - 1; y++) {
                    for (let x = 1; x < width - 1; x++) {
                        const idx = (y * width + x) * 4;
                        
                      
                        const topIdx = ((y - 1) * width + x) * 4;
                        const bottomIdx = ((y + 1) * width + x) * 4;
                        const leftIdx = (y * width + (x - 1)) * 4;
                        const rightIdx = (y * width + (x + 1)) * 4;
                        
                        const verticalDiff = Math.abs(
                            (data[topIdx] + data[topIdx + 1] + data[topIdx + 2]) / 3 - 
                            (data[bottomIdx] + data[bottomIdx + 1] + data[bottomIdx + 2]) / 3
                        );
                        
                        const horizontalDiff = Math.abs(
                            (data[leftIdx] + data[leftIdx + 1] + data[leftIdx + 2]) / 3 - 
                            (data[rightIdx] + data[rightIdx + 1] + data[rightIdx + 2]) / 3
                        );
                        
                        const edgeStrength = (verticalDiff + horizontalDiff) / 2;
                        

                        if (edgeStrength > 20) {
                            const intensity = (data[idx] + data[idx + 1] + data[idx + 2]) / 3;
                            if (intensity < 120) {
                                cracks.push({
                                    x: x,
                                    y: y,
                                    strength: edgeStrength,
                                    intensity: intensity
                                });
                                totalLength += Math.sqrt(verticalDiff * verticalDiff + horizontalDiff * horizontalDiff);
                            }
                        }
                    }
                }
                
                return {
                    points: cracks,
                    totalLength: totalLength,
                    count: Math.max(1, Math.round(cracks.length / 50))
                };
            }

            drawCracks(ctx, crackData, width, height) {
                ctx.clearRect(0, 0, width, height);
                

                ctx.globalAlpha = 0.3;
                ctx.drawImage(document.getElementById('originalCanvas'), 0, 0);
                ctx.globalAlpha = 1.0;
                
        
                if (crackData.points.length > 0) {
                    ctx.fillStyle = '#EF476F';
                    
                    crackData.points.forEach(point => {
                        const size = Math.max(1, Math.min(4, point.strength / 25));
                        ctx.fillRect(point.x, point.y, size, size);
                    });
                }
            }

            updateCrackMetrics(crackData) {
                document.getElementById('crackCount').textContent = crackData.count;
                
                const estimatedLength = (crackData.totalLength / 80).toFixed(1);
                document.getElementById('crackLength').textContent = `${estimatedLength} cm`;
                
                let severity = "Baja";
                if (crackData.count > 10) severity = "Alta";
                else if (crackData.count > 5) severity = "Media";
                
                document.getElementById('crackSeverity').textContent = severity;
                document.getElementById('crackAnalysis').classList.remove('hidden');
            }

            processAnalysisResults(crackData) {
                document.getElementById('progressFill').style.width = '100%';
                document.getElementById('progressText').textContent = '‚úÖ An√°lisis completado';
                
                document.getElementById('analysisDetails').classList.remove('hidden');
                
                const detectionResults = document.getElementById('detectionResults');
                detectionResults.innerHTML = '';
                
                if (crackData.count > 0) {
                    const detectionItem = document.createElement('div');
                    detectionItem.className = 'detection-item';
                    detectionItem.innerHTML = `
                        <div class="detection-icon">
                            <i class="fas fa-crack"></i>
                        </div>
                        <div class="detection-content">
                            <h4>Grietas estructurales detectadas</h4>
                            <p>Se han identificado ${crackData.count} grietas con una longitud total de ${document.getElementById('crackLength').textContent}</p>
                            <div class="detection-confidence">
                                <div class="confidence-fill" style="width: ${Math.min(100, crackData.count * 12)}%"></div>
                            </div>
                            <small>Severidad: ${document.getElementById('crackSeverity').textContent}</small>
                        </div>
                    `;
                    detectionResults.appendChild(detectionItem);
                } else {
                    detectionResults.innerHTML = `
                        <div class="detection-item">
                            <div class="detection-icon" style="background: var(--success);">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="detection-content">
                                <h4>Sin grietas significativas</h4>
                                <p>No se detectaron grietas estructurales preocupantes en la imagen analizada.</p>
                            </div>
                        </div>
                    `;
                }
                
              
                setTimeout(() => {
                    this.showAnalysisResults(crackData);
                }, 1000);
            }

            showAnalysisResults(analysisData = null) {
                const riskLevel = analysisData && analysisData.count > 5 ? 'Alto' : 
                                 analysisData && analysisData.count > 2 ? 'Moderado' : 'Bajo';
                
                const results = {
                    riskLevel: riskLevel,
                    vulnerabilities: [
                        {
                            title: analysisData && analysisData.count > 0 ? 'Grietas detectadas' : 'Sin grietas cr√≠ticas',
                            description: analysisData && analysisData.count > 0 ? 
                                'Se encontraron grietas en la estructura que requieren evaluaci√≥n profesional.' :
                                'La estructura aparenta estar en buen estado. Mant√©n revisiones peri√≥dicas.'
                        },
                        {
                            title: 'Ventanas sin protecci√≥n',
                            description: 'Considera instalar pel√≠culas de seguridad en ventanas grandes.'
                        }
                    ],
                    routes: [
                        {
                            type: 'Evacuaci√≥n general',
                            description: 'Ruta principal hacia zonas seguras elevadas.',
                            shelters: ['Escuela Primaria Central (2km)', 'Gimnasio Municipal (3.5km)']
                        }
                    ],
                    recommendations: [
                        {
                            title: analysisData && analysisData.count > 0 ? 'Evaluaci√≥n profesional' : 'Mantenimiento preventivo',
                            description: analysisData && analysisData.count > 0 ?
                                'Consulta con un ingeniero estructural para evaluaci√≥n detallada.' :
                                'Contin√∫a con revisiones peri√≥dicas y mantenimiento preventivo.'
                        },
                        {
                            title: 'Kit de emergencia',
                            description: 'Actualiza tu kit de emergencia cada 6 meses.'
                        }
                    ]
                };

                this.updateResultsUI(results);
                
                document.getElementById('resultsSection').classList.remove('hidden');
                document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });

                this.updateGlobalRiskLevel(riskLevel);
            }

            updateResultsUI(results) {
 
                const riskBadge = document.getElementById('riskBadge');
                riskBadge.textContent = `Riesgo ${results.riskLevel}`;
                riskBadge.className = `risk-badge ${results.riskLevel.toLowerCase()}-risk`;
                
              
                const vulnerabilitiesList = document.getElementById('vulnerabilitiesList');
                vulnerabilitiesList.innerHTML = '';
                results.vulnerabilities.forEach(vuln => {
                    const item = document.createElement('div');
                    item.className = 'vulnerability-item';
                    item.innerHTML = `<h4>${vuln.title}</h4><p>${vuln.description}</p>`;
                    vulnerabilitiesList.appendChild(item);
                });
                
            
                const evacuationRoutes = document.getElementById('evacuationRoutes');
                evacuationRoutes.innerHTML = '';
                results.routes.forEach(route => {
                    const sheltersHtml = route.shelters.map(shelter => `<li>${shelter}</li>`).join('');
                    const item = document.createElement('div');
                    item.className = 'route-item';
                    item.innerHTML = `
                        <h4>${route.type}</h4>
                        <p>${route.description}</p>
                        <ul>${sheltersHtml}</ul>
                    `;
                    evacuationRoutes.appendChild(item);
                });
                
            
                const improvementTips = document.getElementById('improvementTips');
                improvementTips.innerHTML = '';
                results.recommendations.forEach(tip => {
                    const item = document.createElement('div');
                    item.className = 'tip-item';
                    item.innerHTML = `<h4>${tip.title}</h4><p>${tip.description}</p>`;
                    improvementTips.appendChild(item);
                });
            }

            updateGlobalRiskLevel(riskLevel) {
                document.querySelector('#globalRiskLevel strong').textContent = riskLevel;
                const riskBar = document.getElementById('riskBar');
                
                if (riskLevel === 'Alto') {
                    riskBar.style.width = '85%';
                    riskBar.style.background = 'var(--danger)';
                } else if (riskLevel === 'Moderado') {
                    riskBar.style.width = '55%';
                    riskBar.style.background = 'var(--warning)';
                } else {
                    riskBar.style.width = '25%';
                    riskBar.style.background = 'var(--success)';
                }
            }

         
            setupAlertSystem() {
                const earthquakeToggle = document.getElementById('earthquakeToggle');
                const earthquakeStatus = document.getElementById('earthquakeStatus');
                const emergencyNumbersBtn = document.getElementById('emergencyNumbersBtn');

                if (earthquakeToggle) {
                    earthquakeToggle.addEventListener('change', (e) => {
                        this.earthquakeAlertsActive = e.target.checked;
                        earthquakeStatus.textContent = this.earthquakeAlertsActive ? 'Activado' : 'Inactivo';
                        earthquakeStatus.style.color = this.earthquakeAlertsActive ? 'var(--success)' : '';
                        
                        if (this.earthquakeAlertsActive) {
                            this.showNotification('üîî Alertas s√≠smicas activadas');
                         
                            setTimeout(() => {
                                this.showEarthquakeAlert();
                            }, 5000);
                        }
                    });
                }

                if (emergencyNumbersBtn) {
                    emergencyNumbersBtn.addEventListener('click', () => {
                        this.showEmergencyModal();
                    });
                }

            
                document.querySelector('.close-alert')?.addEventListener('click', () => {
                    this.hideEarthquakeAlert();
                });

        
                document.querySelectorAll('.call-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const number = e.target.closest('.emergency-item').querySelector('.emergency-number').textContent;
                        this.simulateCall(number);
                    });
                });

       
                document.querySelector('.close-modal')?.addEventListener('click', () => {
                    this.hideEmergencyModal();
                });

        
                document.getElementById('emergencyModal')?.addEventListener('click', (e) => {
                    if (e.target === document.getElementById('emergencyModal')) {
                        this.hideEmergencyModal();
                    }
                });
            }

            showEarthquakeAlert() {
                if (!this.earthquakeAlertsActive) return;
                
                const alert = document.getElementById('earthquakeAlert');
                alert.style.display = 'block';
                
             
                this.playAlertSound();

                setTimeout(() => {
                    this.hideEarthquakeAlert();
                }, 15000);
            }

            hideEarthquakeAlert() {
                document.getElementById('earthquakeAlert').style.display = 'none';
            }

            showEmergencyModal() {
                document.getElementById('emergencyModal').style.display = 'flex';
            }

            hideEmergencyModal() {
                document.getElementById('emergencyModal').style.display = 'none';
            }

            simulateCall(number) {
                this.showNotification(`üìû Llamando a ${number}...\n\nNota: Esta es una simulaci√≥n. En una aplicaci√≥n real se iniciar√≠a la llamada.`);
            }

            playAlertSound() {
         
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(600, audioContext.currentTime + 0.1);
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                } catch (error) {
                    console.log('Audio no disponible:', error);
                }
            }

          
            async getWeatherAlerts(lat, lng) {
                try {
                  
                    const mockAlerts = this.generateMockWeatherAlerts(lat, lng);
                    
                    if (mockAlerts.length > 0) {
                        this.showNotification(`üå¶Ô∏è ${mockAlerts.length} alerta(s) meteorol√≥gica(s) para tu zona`);
                        
                       
                        L.marker([lat, lng])
                            .addTo(this.map)
                            .bindPopup(`
                                <div class="weather-alert-popup">
                                    <h4>‚ö†Ô∏è Alertas Meteorol√≥gicas</h4>
                                    ${mockAlerts.map(alert => `
                                        <p><strong>${alert.type}:</strong> ${alert.description}</p>
                                    `).join('')}
                                </div>
                            `)
                            .openPopup();
                    }
                } catch (error) {
                    console.error('Error obteniendo alertas meteorol√≥gicas:', error);
                }
            }

            generateMockWeatherAlerts(lat, lng) {
                const alerts = [];
                const conditions = ['Lluvia intensa', 'Vientos fuertes', 'Tormenta el√©ctrica', 'Granizo'];
                const randomCondition = conditions[Math.floor(Math.random() * conditions.length)];
                
                if (Math.random() > 0.5) {
                    alerts.push({
                        type: randomCondition,
                        description: 'Se esperan condiciones adversas en las pr√≥ximas horas',
                        severity: 'Moderada',
                        time: new Date().toLocaleTimeString()
                    });
                }
                
                return alerts;
            }

   
            showNotification(message, type = 'info') {
  
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <div class="notification-content">
                        <span>${message}</span>
                        <button class="notification-close">&times;</button>
                    </div>
                `;
                

                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: ${type === 'error' ? 'var(--danger)' : 'var(--primary)'};
                    color: white;
                    padding: 15px 20px;
                    border-radius: 10px;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    z-index: 10000;
                    max-width: 400px;
                    text-align: center;
                `;
                
                document.body.appendChild(notification);

                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 5000);
                
         
                notification.querySelector('.notification-close').addEventListener('click', () => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                });
            }

            loadSampleData() {
                this.loadSampleRecommendations();
                this.setupImageAnalysis();
                this.setupAlertSystem();
            }

            loadSampleRecommendations() {
                const sampleRecommendations = [
                    {
                        category: 'Estructural',
                        title: 'Refuerza tu techo',
                        content: 'Los techos planos son vulnerables a huracanes. Considera instalar soportes adicionales y revisar la estructura cada 2 a√±os.',
                        priority: 'Alta',
                        icon: 'fa-house-damage'
                    },
                    {
                        category: 'Preparaci√≥n',
                        title: 'Kit de emergencia',
                        content: 'Prepara un kit con agua, alimentos no perecederos, medicinas y documentos importantes para al menos 3 d√≠as.',
                        priority: 'Media',
                        icon: 'fa-first-aid'
                    },
                    {
                        category: 'Exterior',
                        title: 'Protege ventanas',
                        content: 'Instala contraventanas o pel√≠culas protectoras para prevenir da√±os por vientos fuertes y proyectiles.',
                        priority: 'Alta',
                        icon: 'fa-window-maximize'
                    },
                    {
                        category: 'Seguridad',
                        title: 'Plan familiar',
                        content: 'Establece un punto de encuentro familiar y rutas de evacuaci√≥n en caso de emergencia.',
                        priority: 'Media',
                        icon: 'fa-people-arrows'
                    },
                    {
                        category: 'Prevenci√≥n',
                        title: 'Mantenimiento regular',
                        content: 'Realiza inspecciones trimestrales de grietas, humedades y da√±os estructurales.',
                        priority: 'Baja',
                        icon: 'fa-tools'
                    },
                    {
                        category: 'Tecnolog√≠a',
                        title: 'Sistema de alertas',
                        content: 'Instala sensores de movimiento y sistemas de alerta temprana para terremotos e inundaciones.',
                        priority: 'Media',
                        icon: 'fa-bell'
                    }
                ];

                const sliderWrapper = document.querySelector('.swiper-wrapper');
                sliderWrapper.innerHTML = '';

                sampleRecommendations.forEach(rec => {
                    const slide = document.createElement('div');
                    slide.className = 'swiper-slide';
                    slide.innerHTML = `
                        <span class="slide-category">${rec.category}</span>
                        <h4 class="slide-title">${rec.title}</h4>
                        <p class="slide-content">${rec.content}</p>
                        <div class="slide-priority ${rec.priority === 'Alta' ? 'priority-high' : 
                                                rec.priority === 'Media' ? 'priority-medium' : 'priority-low'}">
                            <i class="fas ${rec.icon}"></i>
                            <span>Prioridad ${rec.priority}</span>
                        </div>
                    `;
                    sliderWrapper.appendChild(slide);
                });

              
                if (this.swiper) {
                    this.swiper.update();
                }
            }

            setupEventListeners() {
              
                document.addEventListener('submit', (e) => e.preventDefault());
                
         
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.closeChatbot();
                        this.hideEmergencyModal();
                        this.hideEarthquakeAlert();
                    }
                });
                

                window.addEventListener('scroll', this.handleScroll.bind(this));
            }

            handleScroll() {
                const scrollPosition = window.scrollY + window.innerHeight;
                const documentHeight = document.documentElement.scrollHeight;
                

                if (scrollPosition >= documentHeight - 500) {
                    this.loadMoreContent();
                }
            }

            loadMoreContent() {
                
                if (!this.contentLoaded) {
                    this.showNotification('üìö Cargando m√°s recomendaciones...');
                    setTimeout(() => {
                        this.loadSampleRecommendations();
                        this.contentLoaded = true;
                    }, 1000);
                }
            }
        }


        document.addEventListener('DOMContentLoaded', function() {

            window.safeHomeApp = new SafeHomeApp();
            
     
            setTimeout(() => {
                window.safeHomeApp.showNotification('üöÄ SafeHome cargado correctamente. ¬°Tu hogar m√°s seguro!');
            }, 1000);
        });

        window.addEventListener('error', function(e) {
            console.error('Error global:', e.error);
        });

        window.addEventListener('unhandledrejection', function(e) {
            console.error('Promise rechazada:', e.reason);
        });

        if (!Element.prototype.scrollIntoView) {
            Element.prototype.scrollIntoView = function() {
                window.scrollTo(0, this.offsetTop);
            };
        }
    </script>
</body>
</html>
